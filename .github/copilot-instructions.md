# DevBench - Copilot Instructions

## Repository Overview

DevBench is a developer PC benchmarking tool focused on measuring build performance for .NET projects. Users clone the repo, run a script, and get detailed performance metrics for their machine.

## Key Files & Their Roles

| Path | Purpose |
|------|---------|
| `src/DevBench.cs` | Main test harness - file-based .NET 10 app with native AOT |
| `run-benchmarks.ps1` | Windows bootstrapper - downloads/builds harness and runs it |
| `run-benchmarks.sh` | Unix bootstrapper - same for macOS/Linux |
| `benchmarks/*/benchmark.json` | Benchmark definitions (see docs/benchmark-schema.md) |
| `results/*.json` | User-submitted benchmark results |
| `site/` | Eleventy static site for displaying results |

## Coding Conventions

### C# (DevBench.cs)
- File-based app using `#:` directives at top
- Use `#:package PackageName@version` for NuGet packages
- Native AOT compatible - avoid reflection where possible
- Platform-specific code uses `#if` preprocessor directives
- Keep in single file - complexity managed via regions

### Benchmark Manifests (benchmark.json)
- Schema documented in `docs/benchmark-schema.md`
- Required fields: `name`, `description`, `type`, `build.full`
- Use `repoRef` for pinning external repos to specific versions

### Results JSON
- Auto-generated by harness, don't edit manually
- Filename format: `results-<timestamp>-<hash>.json`

## Testing Changes Locally

### Test the harness:
```powershell
cd D:\src\github\damianedwards\DevBench
dotnet run src/DevBench.cs
```

### Test a specific benchmark:
```powershell
dotnet run src/DevBench.cs -- --benchmark dotnet-hello-world
```

### Build native AOT locally:
```powershell
dotnet publish src/DevBench.cs
# Output: src/artifacts/DevBench.exe
```

### Test the website:
```powershell
cd site
npm install
npm run dev
```

## Common Tasks

- **Add a benchmark**: Use `.github/prompts/add-benchmark.prompt.md`
- **Debug a benchmark**: Use `.github/prompts/debug-benchmark.prompt.md`
- **Add system info collection**: Use `.github/prompts/add-system-info.prompt.md`

## Architecture

See `docs/architecture.md` for high-level design and data flow diagrams.
